Nous venons de vendre notre premi√®re offre Koomy en marque blanche (white-label) pour 5 000 ‚Ç¨, avec ensuite une maintenance annuelle.
Nous devons maintenant adapter la plateforme SaaS Owner (interface /platform) pour g√©rer proprement ce type de client, sans casser l‚Äôexistant.

üéØ Objectif de cette phase (WL1)
Mettre en place tout ce qu‚Äôil faut, c√¥t√© SaaS Owner + base de donn√©es, pour :

Identifier les communaut√©s en white label

G√©rer leur mode de facturation (contrat manuel vs abonnement Stripe standard)

Sauvegarder des infos de contrat (setup fee, maintenance annuelle, etc.)

Pr√©parer un espace pour la config de branding (qui sera utilis√©e plus tard pour l‚Äôapp white-label + emails)

Ajouter les sections correspondantes dans l‚Äôinterface /platform (SaaS Owner)

‚ö†Ô∏è Important :
Pour cette phase WL1, ne pas modifier :

l‚Äôapp membre (/app)

l‚Äôapp pro (/app/admin)

le backoffice communaut√© (/admin)

On se concentre uniquement sur :

le sch√©ma de donn√©es

les mod√®les TypeScript

et surtout l‚Äôinterface SaaS Owner /platform (c√¥t√© ‚Äúsuper admin Koomy‚Äù).

1Ô∏è‚É£ Mod√®le √©conomique √† int√©grer

Il existe maintenant deux types de communaut√©s :

Communaut√©s standard (self-service)

cr√©√©es depuis le site public Koomy

abonnement r√©gl√© via Stripe (plans Plus / Pro, etc.)

d√©j√† g√©r√© par l‚Äôint√©gration Stripe existante

Communaut√©s White Label (contrat manuel)

cr√©√©es manuellement depuis le SaaS Owner, par nous

facturation one-shot (ex : 5 000 ‚Ç¨) + maintenance annuelle (ex : 1 000 ‚Ç¨/an)

la partie facturation est g√©r√©e en dehors de Stripe pour l‚Äôinstant (factures manuelles)

nous avons besoin d‚Äôun endroit pour enregistrer ces infos contractuelles dans la base et les visualiser dans /platform.

2Ô∏è‚É£ √âvolutions de sch√©ma souhait√©es (communities + contrat + branding)

Merci d‚Äôanalyser shared/schema.ts et de me proposer une √©volution compatible avec l‚Äôexistant.
Voici ce que je veux au niveau concept (√† adapter techniquement √† ce qui existe d√©j√†) :

A. Champs √† ajouter dans communities (ou table √©quivalente)

Flags White Label & mode de facturation

whiteLabel: boolean

default : false

vrai = communaut√© g√©r√©e en marque blanche (app d√©di√©e, branding client)

whiteLabelTier: "basic" | "standard" | "premium" | null

pour diff√©rencier plus tard plusieurs offres white-label

facultatif dans un premier temps (peut rester null)

billingMode: "self_service" | "manual_contract"

self_service = communaut√© standard (abonnement Stripe classique)

manual_contract = communaut√© White Label (contrat manuel, facturation externe √† Stripe)

Infos contrat / facturation (pour suivi interne)

setupFeeAmountCents: integer | null

montant du setup one-shot (ex : 5000 ‚Ç¨ ‚Üí 500000 cents)

setupFeeCurrency: text | default "EUR"

setupFeeInvoiceRef: text | null

r√©f√©rence de facture ou commentaire (ex : ‚ÄúFACT-2025-001‚Äù)

maintenanceAmountYearCents: integer | null

montant annuel de maintenance (ex : 1000 ‚Ç¨ ‚Üí 100000 cents)

maintenanceCurrency: text | default "EUR"

maintenanceNextBillingDate: timestamp | null

prochaine date pr√©vue pour facturation/renouvellement maintenance

maintenanceStatus: "active" | "pending" | "late" | "stopped"

√©tat actuel du contrat de maintenance

Pr√©paration du branding White Label

Pour le branding, je souhaite une structure flexible (JSON) stock√©e au niveau de la communaut√©, par exemple :

brandConfig: jsonb | null


Avec une forme pr√©vue type :

{
  "appName": "Nom de l'app client",
  "brandColor": "#0055AA",
  "logoUrl": "https://...",
  "appIconUrl": "https://...",
  "emailFromName": "Union XYZ",
  "emailFromAddress": "no-reply@unionxyz.fr",
  "replyTo": "contact@unionxyz.fr",
  "showPoweredBy": true
}


‚ö†Ô∏è Pour cette phase WL1 :

Il suffit d‚Äôajouter le champ brandConfig (jsonb) c√¥t√© DB + types TS.

Nous n‚Äôavons pas encore besoin de valider tous les sous-champs, ni de l‚Äôutiliser c√¥t√© emails / front.

L‚Äôobjectif est juste de pouvoir le remplir depuis le SaaS Owner dans un deuxi√®me temps.

Merci de :

garder la r√©tro-compatibilit√©

mettre des valeurs par d√©faut intelligentes

ne rien casser sur les communaut√©s d√©j√† en base.

3Ô∏è‚É£ √âvolutions SaaS Owner ‚Äì UI /platform

Maintenant, c√¥t√© UI SaaS Owner, je veux que pour chaque communaut√©, le ‚Äúsuper admin Koomy‚Äù ait une fiche beaucoup plus riche.

Merci d‚Äôidentifier les fichiers UI du SaaS Owner (/platform), puis :

A. Ajouter dans la fiche communaut√© (vue d√©taill√©e) :

Un bloc visible par exemple dans un onglet d√©di√© ou sections :

Section ‚ÄúMode de facturation‚Äù

Afficher / √©diter :

billingMode (self_service vs manual_contract)

Flag whiteLabel (Oui/Non)

whiteLabelTier (select : Basic / Standard / Premium / Aucun)

Pour les communaut√©s billingMode = self_service :

afficher les infos Stripe existantes (plan, statut abonnement) comme aujourd‚Äôhui

Pour les communaut√©s billingMode = manual_contract :

masquer les actions li√©es √† la souscription Stripe

afficher la notion ‚ÄúContrat manuel / White Label‚Äù clairement

Section ‚ÄúContrat & facturation‚Äù (pour manual_contract)

Permettre d‚Äôafficher/√©diter :

Setup fee :

Montant (en ‚Ç¨)

Devise

R√©f√©rence facture

Maintenance :

Montant annuel (en ‚Ç¨)

Devise

Prochaine date de facturation / renouvellement

Statut maintenance (active / pending / late / stopped)

Zone de notes internes (texte libre) ‚Äì soit un champ dans communities, soit dans une table s√©par√©e si n√©cessaire (√† toi de voir).

Un affichage en simple formulaire (input / select) suffit pour commencer.

Section ‚ÄúBranding White Label‚Äù (si whiteLabel = true)

Cr√©er un bloc simple qui permet de saisir les √©l√©ments principaux de brandConfig :

Nom de l‚Äôapp telle que vue par les membres (appName)

Couleur principale (brandColor ‚Äì avec un input texte, voire color picker si simple)

Logo (URL ou upload si d√©j√† g√©r√© ailleurs)

Email From Name / From Address / Reply-To

Checkbox showPoweredBy (powered by Koomy.app)

Pour cette phase, le but est purement :

saisir / stocker ces infos dans brandConfig

les restituer dans l‚ÄôUI
(on n‚Äôa pas encore besoin de c√¢bler ce branding dans les apps membres / emails)

4Ô∏è‚É£ Contraintes & priorit√©s

Ne rien casser sur les communaut√©s existantes.

Ne pas modifier pour l‚Äôinstant :

les flows Stripe Billing existants (self_service)

les apps membres/pro/backoffice

les emails transactionnels

Tout ce que tu ajoutes doit √™tre :

bien typ√© c√¥t√© TS

int√©gr√© aux types existants (Community, etc.)

accessible uniquement depuis le SaaS Owner /platform (r√¥le super-admin)

5Ô∏è‚É£ Plan attendu

Avant d‚Äôimpl√©menter directement, merci de :

Analyser le sch√©ma et l‚Äôexistant autour de communities et du SaaS Owner.

Me proposer :

la liste pr√©cise des champs que tu comptes ajouter dans communities

o√π tu stockes brandConfig

les composants/pages √† modifier c√¥t√© /platform

Puis, apr√®s validation dans ta r√©ponse, impl√©menter :

la migration sch√©ma / Drizzle

les types / insert/update schema

l‚Äôaffichage/√©dition dans la fiche communaut√© SaaS Owner.

Fin du prompt.