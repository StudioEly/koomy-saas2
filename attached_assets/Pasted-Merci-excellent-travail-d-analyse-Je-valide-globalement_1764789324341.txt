Merci, excellent travail dâ€™analyse.
Je valide globalement la proposition de schÃ©ma avec quelques prÃ©cisions importantes ci-dessous.

âœ” 1. Champs communities â†’ VALIDÃ‰S

Les champs suivants conviennent parfaitement :

stripeConnectAccountId

paymentsEnabled

platformFeePercent = 2 % par dÃ©faut

âš ï¸ Ajouter aussi un champ dÃ©rivÃ© du plan :

maxMembersAllowed  // 50 pour Free, 1000 pour Plus, 5000 pour Pro


Ce champ sera rempli automatiquement selon le plan choisi.

âœ” 2. Champs userCommunityMemberships â†’ VALIDÃ‰S

Les champs :

membershipPaidAt

membershipValidUntil

membershipAmountPaid

sont suffisants pour tracer lâ€™historique minimum.
On garde aussi contributionStatus existant.

âœ” 3. Table collections â†’ VALIDÃ‰E, avec ajustements

Ajouter ces deux prÃ©cisions :

1ï¸âƒ£ amountCents correspond au montant que chaque participant doit payer.
2ï¸âƒ£ targetAmountCents est optionnel (objectif global).

Ajouter aussi :

allowCustomAmount boolean default false


â†’ Pour permettre Ã  certaines collectes de laisser lâ€™utilisateur choisir le montant.

Le reste est parfait.

âœ” 4. Table transactions â†’ VALIDÃ‰E, avec un ajustement

La structure couvre bien tous les flux (subscription, membership, collection).

Seul ajustement demandÃ© :

Ajouter :

stripeApplicationFeeId text null


â†’ pour stocker lâ€™ID de la commission reversÃ©e Ã  Koomy.

Le champ amountToCommunity doit reprÃ©senter :

amountTotal - amountFeeKoomy - frais Stripe


(les frais Stripe pourront Ãªtre dÃ©duits plus tard si nÃ©cessaire).

âœ” 5. Relations â†’ VALIDÃ‰ES

Les relations proposÃ©es pour collections et transactions sont bonnes.

â— 6. Demande additionnelle (important)

Merci dâ€™ajouter dans communities :

subscriptionPlan text default 'free'
subscriptionPeriod text default null
subscriptionStatus text default 'none'
subscriptionCurrentPeriodEnd timestamp null


â†’ cela facilitera la Phase 2 Stripe Billing.

ğŸ‘‰ Conclusion

Je valide donc la Phase 1 avec les ajustements ci-dessus.
Tu peux maintenant :

1ï¸âƒ£ mettre Ã  jour la proposition de schÃ©ma,
2ï¸âƒ£ me gÃ©nÃ©rer les migrations complÃ¨tes,
3ï¸âƒ£ attendre ma validation avant de les exÃ©cuter.

Ensuite seulement, nous passerons Ã  la Phase 2.